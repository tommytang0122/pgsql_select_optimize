# 並行請求實作說明

## 概述

並行請求 (Parallel Requests) 使用 `Promise.all` 同時發送多個 HTTP 請求，減少等待時間。

## 原理

```
順序請求 (目前):
請求1 ────────▶ 等待 ────────▶ 
                              請求2 ────────▶ 等待 ────────▶
                                                            請求3 ...
總時間 = N × 單次時間

並行請求:
請求1 ────────▶ 等待 ────────▶ ┐
請求2 ────────▶ 等待 ────────▶ ├─▶ 合併結果
請求3 ────────▶ 等待 ────────▶ ┘
總時間 ≈ 單次時間 (理想情況)
```

## 設定

**檔案**: `static/app.js` 第 11-16 行

```javascript
const CONFIG = {
    USE_BATCH_LOADING: true,    // 目前: 分批載入
    USE_PARALLEL: false,        // 目前: 關閉 (順序請求)
    BATCH_SIZE: 10000,          // 每批 10,000 筆 = 10 次
    PARALLEL_LIMIT: 5,          // 並行數量上限
};
```

## 參數說明

| 參數 | 說明 | 目前值 |
|------|------|--------|
| `USE_PARALLEL` | 是否啟用並行 | `false` |
| `PARALLEL_LIMIT` | 最大並行數 | `5` |
| `BATCH_SIZE` | 每批筆數 | `10000` |

## 性能比較

### 100,000 筆數據，分 10 批

| 方式 | 請求模式 | 預估時間 |
|------|---------|---------|
| 順序 (目前) | 1→2→3→...→10 | ~4 秒 |
| 並行 (5個) | [1-5] → [6-10] | ~1.6 秒 |
| 全並行 (10個) | [1-10] | ~0.8 秒 |

節省: **60-80%**

## 為什麼需要 PARALLEL_LIMIT?

同時發太多請求會:
1. 瀏覽器連線數限制 (通常 6 個/域名)
2. 後端壓力過大
3. 記憶體佔用過高

## 開關切換

```javascript
// static/app.js 第 13 行

USE_PARALLEL: true   // 啟用並行
USE_PARALLEL: false  // 停用 (目前，順序請求)
```

## 載入模式組合

| USE_BATCH_LOADING | USE_PARALLEL | 實際行為 |
|-------------------|--------------|---------|
| `false` | - | 一次載入 |
| `true` | `false` | 順序分批 (目前) |
| `true` | `true` | 並行分批 |

## 注意事項

1. **順序合併**: 並行請求的結果需按原順序合併
2. **錯誤處理**: 任一請求失敗會導致整批失敗
3. **進度更新**: 以組為單位更新進度
