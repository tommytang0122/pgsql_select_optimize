# 載入時間優化測試結果

測試日期: 2026-01-20
環境: localhost (Docker PostgreSQL)

## 測試環境

- **資料庫**: PostgreSQL 16 (Docker, port 5433)
- **資料表**: data_100k (100,000 筆, 27 欄)
- **後端**: FastAPI + psycopg2
- **前端**: 虛擬列表 (Virtual Scrolling)

---

## 1. 不同筆數的查詢時間

| 筆數 | 查詢時間 | 每筆平均 |
|------|---------|---------|
| 1,000 | **40ms** | 0.040ms |
| 10,000 | **304ms** | 0.030ms |
| 100,000 | **2.95秒** | 0.029ms |

---

## 2. GZip 壓縮測試 (10,000 筆)

| 模式 | 傳輸大小 | 節省 |
|------|---------|------|
| 無壓縮 | 2,171,110 bytes (~2.1MB) | - |
| GZip | 722,956 bytes (~723KB) | 66.7% |

### GZip 時間測試 (100,000 筆)

| 模式 | 載入時間 | 備註 |
|------|---------|------|
| 無 GZip | **2.8 秒** | ✅ 更快 |
| 有 GZip | **6.1 秒** | ❌ 更慢 |

**結論**: localhost 環境下，GZip 的 CPU 開銷 > 網路節省，應關閉。

---

## 3. 連線池測試

| 模式 | 單次查詢時間 | 備註 |
|------|-------------|------|
| 直接連線 | ~25ms | 含連線建立 |
| 連線池 | ~5ms | 重用連線 |

**節省**: ~20ms/請求

---

## 4. 載入方式比較

### 分批載入 vs 一次載入 (100,000 筆)

| 方式 | HTTP 請求數 | 預估時間 |
|------|------------|---------|
| 分批 (10 批 × 10,000) | 10 次 | ~4 秒 |
| 一次載入 | 1 次 | ~3 秒 |

**節省**: ~1 秒 (25%)

---

## 5. 虛擬列表性能

| 指標 | 傳統渲染 | 虛擬列表 |
|------|---------|---------|
| DOM 節點數 | 2,700,000 | ~945 |
| 記憶體使用 | ~500MB | ~10MB |
| 渲染時間 | 10+ 秒 | < 0.1 秒 |

---

## 目前配置

| 設定 | 值 | 檔案 |
|------|------|------|
| `USE_GZIP` | `False` | main.py |
| `USE_CONNECTION_POOL` | `False` | main.py |
| `USE_BATCH_LOADING` | `true` | app.js |
| `USE_PARALLEL` | `false` | app.js |
| `BATCH_SIZE` | `10000` | app.js |

---

## 瓶頸分析 (100,000 筆一次載入)

```
總時間 ~3 秒
├── DB 查詢     : ~200ms  (7%)
├── JSON 序列化 : ~800ms  (27%)
├── 網路傳輸    : ~1500ms (50%)  ← 主要瓶頸
└── HTTP 開銷   : ~500ms  (16%)
```
